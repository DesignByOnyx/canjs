<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE — ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: docs/can-guides/topics/data/managing-sessions.md
	@page guides/data-managing-sessions
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CanJS - Managing Sessions</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
		<link rel="stylesheet" type="text/css" href="../static/bundles/bit-docs-site/static.css">
		<link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href="/docs/images/canjs_favicon.ico">
		<link rel="apple-touch-icon" sizes="57x57" href="../../docs/images/canjs_favicon_57x57.png">
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../docs/images/canjs_favicon_57x57.png">
		<link rel="apple-touch-icon" sizes="72x72" href="../../docs/images/canjs_favicon_72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="../../docs/images/canjs_favicon_114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="../../docs/images/canjs_favicon_128x128.png">
		<link rel="apple-touch-icon" sizes="144x144" href="../../docs/images/canjs_favicon_144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="../../docs/images/canjs_favicon_152x152.png">
		<meta content="yes" name="apple-mobile-web-app-capable">
	  	<meta name="apple-mobile-web-app-status-bar-style" content="white-translucent">
	
	
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-2302003-11', 'auto');
			ga('send', 'pageview');
		</script>
	
</head>
	<body>
		<input type="checkbox" id="nav-trigger" class="nav-trigger"/>
		<label for="nav-trigger">Menu</label>
	  	<div id="everything">
  <div id="left" class="column">
    <div class="top-left">
      
          <div class="brand">
	<div class="logo">
		<a href="../../index.html" alt="CanJS"></a>
		<div class="dropdown project-dropdown">
			<a href="https://donejs.com/">DoneJS</a>
			<a href="https://stealjs.com/">StealJS</a>
			<a href="https://jquerypp.com/">jQuery++</a>
			<a href="https://funcunit.com/">FuncUnit</a>
			<a href="https://documentjs.com/">DocumentJS</a>
		</div>
	</div>
	<div class="version">
		<div class="version-number">
			5.18.2
		</div>
		<div class="dropdown version-dropdown">
			
				<a href="https://v4.canjs.com">4.3.0</a>
			
				<a href="https://v3.canjs.com">3.13.1</a>
			
				<a href="https://v2.canjs.com">2.3.35</a>
			
		</div>
	</div>
</div>
<div class="search-bar">
	<div class="search-wrap" style="display:none;">
		<span class="search-icon"></span>
		<input
			type="text"
			size="6"
			class="search"
			placeholder="Search"
			autocomplete="off"
			autocorrect="off"
			autocapitalize="none"
			spellcheck="false"/>
			<span class="search-icon-cancel"></span>
	</div>
</div>


      
    </div>
    <div class="bottom">
      <div class="nav-menu">
        <div class="social-side-container">
          <ul class="social-side">
  <li>
    <a class="header-mobile github" href="https://github.com/canjs/canjs" target="_blank"><img class="social-icon-small" src="../../docs/images/github.png">Github</a>
  </li>
  <li>
    <a class="header-mobile twitter" href="https://twitter.com/canjs" target="_blank"><img class="social-icon-small" src="../../docs/images/twitter.png">Twitter</a>
  </li>
</ul>
<ul class="social-side">
  <li>
    <a class="header-mobile" href="https://gitter.im/canjs/canjs" target="_blank">Chat</a>
  </li>
  <li>
    <a class="header-mobile" href="http://forums.donejs.com/c/canjs" target="_blank">Forum</a>
  </li>
</ul>

        </div>
        
            
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../about.html"
							title="Learn about CanJS’s mission, technical highlights, who uses CanJS, and our future roadmap.">
							About
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="../guides.html"
							title="Welcome to CanJS! These guides are here to help you master CanJS development, get involved with the CanJS community,
and contribute back to CanJS.">
							Guides
						</a>
						
	<ul>
		
			
				
					<li>
						<span>essentials</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="setup.html"
							title="Learn how to install CanJS in your environment.">
							Setting Up CanJS
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="technology-overview.html"
							title="Learn the basics of CanJS’s technology.">
							Technology Overview
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="html.html"
							title="Learn how to update HTML and listen to user interactions.">
							HTML
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="routing.html"
							title="Learn how to make your application respond to changes in the URL and work with the browser’s back and forward buttons.">
							Routing
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="data.html"
							title="Learn how to get, create, update, and delete backend service layer data.">
							Service Layer
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="debugging.html"
							title="Learn how to debug CanJS applications.">
							Debugging
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="forms.html"
							title="Learn how to create amazing &lt;form&gt;s with CanJS.">
							Forms
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="testing.html"
							title="Learn how to test CanJS applications.">
							Testing
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="logic.html"
							title="Learn how to write observables in an organized, maintainable, and testable way.">
							Logic
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						parent
           						expanded">
						<a class="page"
							href="data-extreme.html"
							title="learn how to work with can-connect">
							Data
						</a>
						
	<ul>
		
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="data-making-requests.html"
							title="URL, query, and response formats for making requests.">
							Making requests
						</a>
						

					</li>
				
			
		
			
				
					<li class="current
           						
           						expanded">
						<a class="page"
							href="data-managing-sessions.html"
							title="Learn how to manage sessions with can-connect">
							Managing Sessions
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>app guides</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="chat.html"
							title="This guide will walk you through building a real-time chat application with CanJS’s Core libraries.  It takes about 30 minutes to complete.">
							Chat Guide
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="todomvc.html"
							title="This guide will walk you through building a slightly modified version of TodoMVC with CanJS’s Core libraries and can-fixture. It takes about 1 hour to complete.">
							TodoMVC Guide
						</a>
						

					</li>
				
			
		
			
		
	</ul>


					</li>
				
			
		
			
				
					<li class="
           						parent
           						">
						<a class="page"
							href="recipes.html"
							title="A listing of small examples that are useful for learning CanJS.">
							recipes
						</a>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/canvas-clock.html"
							title="This guide walks you through building a clock with the Canvas API.">
							Canvas Clock (Simple)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/credit-card-advanced.html"
							title="This guide walks through building a simple credit card payment form with validations. It doesn’t use
can-define. Instead it uses Kefir.js streams to make a ViewModel.
can-kefir is used to make the Kefir streams observable to can-stache.">
							Credit Card Guide (Advanced)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/credit-card-simple.html"
							title="This guide walks through building a very simple credit card payment form.  It uses Stripe.js v2 API to create a token
which can be used to create a charge.  It also performs
simple validation on the payment form values.">
							Credit Card Guide (Simple)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/cta-bus-map.html"
							title="This guide walks you through showing Chicago Transit Authority (CTA) bus locations on a Google Map.">
							CTA Bus Map (Medium)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/file-navigator-advanced.html"
							title="This guide walks you through building a file navigation widget that requests data with fetch. It takes about 45 minutes to complete.">
							File Navigator Guide (Advanced)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/file-navigator-simple.html"
							title="This guide walks you through building a simple file navigation widget.  It takes about 25 minutes to complete.  It was written with
CanJS 3.10. Check out the file-navigator-advanced
for an example that makes AJAX requests for its data and uses can-component.">
							File Navigator Guide (Simple)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/modals.html"
							title="This guide shows how to create a multiple modal form.">
							Multiple Modals (Medium)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/playlist-editor.html"
							title="Learn how to use YouTube’s API to search for videos and make a playlist.  This makes authenticated requests with OAuth2. It uses jQuery++ for
drag/drop events. It shows using custom attributes and custom events.  This guide takes
an hour to complete.">
							Playlist Editor (Advanced)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/search-list-details.html"
							title="This guide walks through building a Search, List, Details flow with lazy-loaded routes.">
							Search, List, Details (Advanced)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/signup-simple.html"
							title="This guide walks through building simple signup, login forms and a logout button.">
							Signup and Login (Simple)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/text-editor.html"
							title="This guide walks you through building a basic rich text editor.">
							Text Editor (Medium)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/tinder-carousel.html"
							title="This guide walks you through building a Tinder-like carousel. Learn how to build apps that use dragging user interactions.">
							Tinder Carousel (Medium)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/todomvc-with-steal.html"
							title="This tutorial walks through building TodoMVC with StealJS. It includes KeyNote presentations
covering CanJS core libraries.">
							TodoMVC with StealJS
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/video-player.html"
							title="This guide walks you through building custom video controls around a video element.">
							Video Player (Simple)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/weather-report-advanced.html"
							title="This guides you through extending the Simple Weather Report Guide to remove imperative code and automatically look up the user’s location using the
browser’s geolocation API.  Both of these will be done with event streams.
This guide continues where the Simple Weather Report Guide left off.  It takes about 25 minutes to complete.  It was written with CanJS 4.1.">
							Weather Report Guide (Advanced)
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="recipes/weather-report-simple.html"
							title="This guide walks you through building a simple weather report widget.  It takes about 25 minutes to complete.  It was written with
CanJS 4.1.">
							Weather Report Guide (Simple)
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>upgrade</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../migrate-3.html"
							title="This guide walks you through the step-by-step process to upgrade a 2.x app to CanJS 3.">
							Migrating to CanJS 3
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../migrate-4.html"
							title="This guide walks you through the step-by-step process to upgrade a 3.x app to CanJS 4.">
							Migrating to CanJS 4
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../migrate-5.html"
							title="This guide walks you through the process to upgrade a 4.x app to CanJS 5.x.">
							Migrating to CanJS 5
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="upgrade/using-codemods.html"
							title="Learn how to migrate your app to CanJS 3 using can-migrate.">
							Using Codemods
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li>
						<span>other</span>
						
	<ul>
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="api.html"
							title="This page walks through how to use and understand CanJS’s API documentation.">
							Reading the Docs (API Guide)
						</a>
						

					</li>
				
			
		
	</ul>


					</li>
				
			
		
	</ul>


					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../api.html"
							title="Welcome to the CanJS API documentation! This page is a CHEAT-SHEET for the most common APIs within CanJS. Read the
technology-overview page for background on the following APIs.">
							API Docs
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="../community.html"
							title="Get involved with one of the most inviting communities on the internet!">
							Community
						</a>
						

					</li>
				
			
		
			
				
					<li class="
           						
           						">
						<a class="page"
							href="contribute.html"
							title="Learn how to contribute to CanJS!">
							Contributing
						</a>
						

					</li>
				
			
		
	</ul>


        
      </div>
      <div class="search-results-container">
	<div class="search-results-wrap"></div>
</div>

    </div>
  </div>
  <div id="right" class="column">
    <div class="top-right">
      <div class="top-right-top">
	<ul class="top-right-bitovi">
	  	<li class="dropdown">
	    	<a href="https://www.bitovi.com" class="bitovi icon-bits">Bitovi</a>
	    	<ul class="dropdown-menu">
	      		<li><a href="https://www.bitovi.com/">Bitovi.com</a></li>
	      		<li><a href="https://www.bitovi.com/blog">Blog</a></li>
	      		<li><a href="https://www.bitovi.com/design">Design</a></li>
	      		<li><a href="https://www.bitovi.com/development">Development</a></li>
	      		<li><a href="https://www.bitovi.com/training">Training</a></li>
	      		<li><a href="https://www.bitovi.com/open-source">Open Source</a></li>
	      		<li><a href="https://www.bitovi.com/about">About</a></li>
	      		<li><a href="https://www.bitovi.com/contact">Contact Us</a></li>
	    	</ul>
	  	</li>
	</ul>
	<div class="brand">
		<div class="logo">
			<a href="../../index.html" alt="CanJS"></a>
		</div>
	</div>
	<ul class="top-right-links">
  <li>
    <a href="https://gitter.im/canjs/canjs">Chat</a>
  </li>
  <li>
    <a href="http://forums.donejs.com/c/canjs">Forum</a>
  </li>
  <li>
    <a class="github-button nav-social" href="https://github.com/canjs/canjs" data-count-href="/canjs/canjs/stargazers" data-show-count="true">Star</a>
  </li>
  <li>
    <a href="https://twitter.com/canjs" class="twitter-follow-button nav-social" data-show-count="true" data-show-screen-name="false">Follow @canjs</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </li>
</ul>
</div>
<div class="breadcrumb">
	
		<li><a href="../../index.html">CanJS</a></li>
		<li> / </li>
	
		<li><a href="../guides.html">Guides</a></li>
		<li> / </li>
	
		<li><a href="data-extreme.html">Data</a></li>
		<li> / </li>
	
	
	<li><a href="data-managing-sessions.html">Managing Sessions</a></li>
	
	<li class="breadcrumb-dropdown-separator"> / </li>
	<li class="breadcrumb-dropdown breadcrumb-on-this-page">
		<a> On this page</a>
		<ul class="on-this-page"></ul>
	</li>
	<div class="nav-toggle" title="Back to top"></div>
</div>


    </div>
    <div class="bottom">
      <article>
  <section class="title">
	<div class="page-type">
		<h1>Managing Sessions</h1>
			<ul class="title-social">
				
				
				<li>
					<a class="button-link" href="//github.com/canjs/canjs/edit/master/docs/can-guides/topics/data/managing-sessions.md">Edit on GitHub</a>
				</li>
				
			</ul>
	</div>
	<div class="clear-both"></div>
	
  
	<section class="description">
    <p>Learn how to manage sessions with <a href="../can-connect.html" title="can-connect provides persisted data middleware. Assemble powerful model layers from fully modularized behaviors (i.e. plugins).">can-connect</a></p>

</section>

  
	
</section>
<section class="on-this-page-table">
	<!--<h2 class="on-this-page-title" data-skip>Page Content</h2>-->
</section>










  
    <section class="body">
    <h2>Overview</h2>
<p>This section describes how to manage user sessions using <a href="../can-connect.html" title="can-connect provides persisted data middleware. Assemble powerful model layers from fully modularized behaviors (i.e. plugins).">can-connect</a>. Every application is different and will have different requirements for working with session data. The examples below describe how to use a <a href="https://jwt.io/">JWT</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage">sessionStorage</a> to manage a user's session. The same techniques can be applied to other session strategies as well.</p>
<blockquote>
<p>The examples below will use the following file structure. This file structure is arbitrary and the reader is encouraged to change the structure to suit their needs:</p>
<pre><code>your-app
├── app.js
├── components
    ├── sign-in-form.js
    ├── logout-button.js
├── models
    ├── session.js
    ├── session-behavior.js
</code></pre>
</blockquote>
<h2>Building the session behavior</h2>
<p>Before we start, let's think about the steps involved with managing a user session. User sessions are generally created and managed by an external source such as a server or <a href="http://oauth.net/">OAuth</a> provider. The client application must be able to communicate with this external source to do the following:</p>
<ol>
<li>get and validate a user session (if it exists)</li>
<li>create a user session</li>
<li>destroy a user session</li>
</ol>
<p>Knowing this information, we can begin to create our session behavior. Since we are communicating with an external data source, we will want to implement the <a href="../can-connect/DataInterface.html" title="The most common raw data methods.">DataInterface</a> methods for loading, creating, and destroying the session data. Here is the basic structure for our session behavior:</p>
<p><strong>./models/session-behavior.js</strong></p>
<pre><code class="language-js">import connect from 'can-connect';
import ajax from 'can-ajax';
import decode from 'jwt-decode';

const STORAGE_KEY = 'session-jwt';

const sessionBehavior = connect.behavior('data/session', function (base) {
    return {
        // optional - useful for one-time setup and configuration
        init() {
            base.init.apply(this, arguments);
        },

        // loads and validates an existing session
        getData() { ... },

        // creates a new session
        createData(data) { ... },

        // destroys an existing session
        destroyData() { ... }
    };
});

export default sessionBehavior;
</code></pre>
<h2>Building the session model/connection</h2>
<p>The session behavior is responsible for loading data from an external source. Therefore, we want to build a connection which uses the above session behavior instead of the <a href="../can-connect/data/url/url.html" title="">data-url behavior</a> for fetching data from the external source:</p>
<p><strong>./models/session.js</strong></p>
<pre><code class="language-js">// import the core behaviors needed by the connection
import connect from 'can-connect';
import dataParse from 'can-connect/data/parse/parse';
import construct from 'can-connect/constructor/constructor';
import constructStore from 'can-connect/constructor/store/store';
import canMap from 'can-connect/can/map/map';
import canRef from 'can-connect/can/ref/ref';
import callbacksOnce from 'can-connect/constructor/callbacks-once/callbacks-once';
import dataCallbacks from 'can-connect/data/callbacks/callbacks';
import realtime from 'can-connect/real-time/real-time';

// import the observable class factories
import DefineMap from 'can-define/map/map';
import DefineList from 'can-define/list/list';

// import the session behavior 
import sessionBehavior from './session-behavior';

// define the Session class
const Session = DefineMap.extend('Session', {
  exp: { type: 'any', identity: true }
});

Session.List = DefineList.extend({ 
  '#': Session 
});

// create the session connection
Session.connection = connect(
    [
       // use the session behavior
        sessionBehavior,
        construct,
        canMap,
        canRef,
        constructStore,
        dataCallbacks,
        dataParse,
        realtime,
        callbacksOnce
    ],
    {
        Map: Session,
        List: Session.List,
        name: 'session'
    }
);

export default Session;
</code></pre>
<h2>Loading session data</h2>
<p>When a user first loads the app, we must first check to see if a session exists. In this case we check for a <a href="https://jwt.io/">JWT</a> in <code>sessionStorage</code> and validate it. If the JWT does not exist or is invalid, we must return an error. This is all done inside the <code>getData</code> method for the session behavior:</p>
<p><strong>./models/session-behavior.js</strong></p>
<pre><code class="language-js">import connect from 'can-connect';
import ajax from 'can-ajax';
import decode from 'jwt-decode';

const STORAGE_KEY = 'session-jwt';

const sessionBehavior = connect.behavior('data/session', function (base) {
    return {
        // optional - useful for one-time setup and configuration
        init() {
            base.init.apply(this, arguments);
        },

        // loads and validates an existing session
        getData() {
            // check if token exists
            try {
                const token = sessionStorage.getItem(STORAGE_KEY);
                if(!token) {
                    throw new Error('No token found');
                }
            
                // check if token is valid or expired
                const payload = decode(JSON.parse(token));
                if(!payload || payload.exp * 1000 &gt; Date.now()) {
                    throw new Error('Invalid token');
                }
            } catch(ex) {
                return Promise.reject(ex);
            }
            
            // success, resolve with the payload
            return Promise.resolve(payload);
        },

        // creates a new session
        createData(data) {
            return ajax({ 
                type: 'POST', 
                url: '/api/login', 
                data: {
                    username: data.username,
                    password: data.password
                }
            }).then(jwt =&gt; {
                // store the result JWT for later
                sessionStorage.setItem(STORAGE_KEY, jwt);
                
                // return the decoded payload
                return decode(jwt);
            });
        },

        // destroys an existing session
        destroyData() {
            sessionStorage.removeItem(STORAGE_KEY);
            return Promise.resolve(true);
        }
    };
});

export default sessionBehavior;

</code></pre>
<div line-highlight='14-34,only'></div>
<p>During our main application startup, we can check to see if the user session exists. If the session exists, the app can continue loading data. If the session does not exist or is invalid, the app should redirect to the login screen. Since every app is different, it is up to the reader to load application content or redirect the user accordingly.</p>
<p><strong>./app.js</strong></p>
<pre><code class="language-js">import Session from './models/session';

// during app startup
Session.get().then(payload =&gt; {
  // the session was valid - load the app content
}).catch(err =&gt; {
  // session not valid - redirect to sign in page
});
</code></pre>
<h2>Creating a new session</h2>
<p>At some point a user must be able to sign in to your application. During the sign in process you generally send user data to an external data source and retrieve the new session information (or an error). In the following example, we show how to <code>POST</code> a username and password to an external server:</p>
<p><strong>./models/session-behavior.js</strong></p>
<pre><code class="language-js">import connect from 'can-connect';
import ajax from 'can-ajax';
import decode from 'jwt-decode';

const STORAGE_KEY = 'session-jwt';

const sessionBehavior = connect.behavior('data/session', function (base) {
    return {
        // optional - useful for one-time setup and configuration
        init() {
            base.init.apply(this, arguments);
        },

        // loads and validates an existing session
        getData() {
            // check if token exists
            try {
                const token = sessionStorage.getItem(STORAGE_KEY);
                if(!token) {
                    throw new Error('No token found');
                }
            
                // check if token is valid or expired
                const payload = decode(JSON.parse(token));
                if(!payload || payload.exp * 1000 &gt; Date.now()) {
                    throw new Error('Invalid token');
                }
            } catch(ex) {
                return Promise.reject(ex);
            }
            
            // success, resolve with the payload
            return Promise.resolve(payload);
        },

        // creates a new session
        createData(data) {
            return ajax({ 
                type: 'POST', 
                url: '/api/login', 
                data: {
                    username: data.username,
                    password: data.password
                }
            }).then(jwt =&gt; {
                // store the result JWT for later
                sessionStorage.setItem(STORAGE_KEY, jwt);
                
                // return the decoded payload
                return decode(jwt);
            });
        },

        // destroys an existing session
        destroyData() {
            sessionStorage.removeItem(STORAGE_KEY);
            return Promise.resolve(true);
        }
    };
});

export default sessionBehavior;

</code></pre>
<div line-highlight='36-52,only'></div>
<p>Within the application the user will sign in by entering their credentials into a sign in form. When the user clicks <code>SUBMIT</code> on the form, we will take the form values and create the user session. Since every application is different, it is up to the reader to get the values from the form. It is also the reader's responsiblity to redirect the user or display an error message accordingly:</p>
<p><strong>./components/sign-in-form.js</strong></p>
<pre><code class="language-js">import Session from './models/session';

// handle form &quot;submit&quot; event
handleSubmit(ev) {
  ev.preventDefault();
  
  // get the username and password values
  const { username, password } = this.state;
  
  // instantiate a new session
  const session = new Session({ username, password });
  
  // save the new session and handle the response
  session.save().then(payload =&gt; {
    // success - redirect to your application
  }).catch(err =&gt; {
    // failure - display error message
  });
}
</code></pre>
<h2>Destroying a session</h2>
<p>At some point a user must be able to log out of your application. Upon logging out, the session information is deleted by deleting the JWT from <code>sessionStorage</code>. Some applications might require more complex functionality, and it is up to the reader to implement such functionality:</p>
<p><strong>./models/session-behavior.js</strong></p>
<pre><code class="language-js">import connect from 'can-connect';
import ajax from 'can-ajax';
import decode from 'jwt-decode';

const STORAGE_KEY = 'session-jwt';

const sessionBehavior = connect.behavior('data/session', function (base) {
    return {
        // optional - useful for one-time setup and configuration
        init() {
            base.init.apply(this, arguments);
        },

        // loads and validates an existing session
        getData() {
            // check if token exists
            try {
                const token = sessionStorage.getItem(STORAGE_KEY);
                if(!token) {
                    throw new Error('No token found');
                }
            
                // check if token is valid or expired
                const payload = decode(JSON.parse(token));
                if(!payload || payload.exp * 1000 &gt; Date.now()) {
                    throw new Error('Invalid token');
                }
            } catch(ex) {
                return Promise.reject(ex);
            }
            
            // success, resolve with the payload
            return Promise.resolve(payload);
        },

        // creates a new session
        createData(data) {
            return ajax({ 
                type: 'POST', 
                url: '/api/login', 
                data: {
                    username: data.username,
                    password: data.password
                }
            }).then(jwt =&gt; {
                // store the result JWT for later
                sessionStorage.setItem(STORAGE_KEY, jwt);
                
                // return the decoded payload
                return decode(jwt);
            });
        },

        // destroys an existing session
        destroyData() {
            sessionStorage.removeItem(STORAGE_KEY);
            return Promise.resolve(true);
        }
    };
});

export default sessionBehavior;

</code></pre>
<div line-highlight='54-58,only'></div>
<p>Within our application, the user can click a &quot;Log Out&quot; button to end their session. When the button is clicked, we will destroy the session. Since every app is different, it is up to the reader to redirect the user accordingly:</p>
<p><strong>./components/logout-button.js</strong></p>
<pre><code class="language-js">import Session from './models/session';

// handle button &quot;click&quot; event
handleClick(ev) {
  ev.preventDefault();
  
  // destroy the current session
  Session.connection.destroy().then(() =&gt; {
    // redirect the user
  });
}
</code></pre>

</section>

  


<script type="text/javascript">
  window.docObject = {"src":{"path":"docs/can-guides/topics/data/managing-sessions.md"},"description":"Learn how to manage sessions with [can-connect] \n","name":"guides/data-managing-sessions","title":"Managing Sessions","type":"page","parent":"guides/data-extreme","outline":"3","comment":" ","pathToRoot":"../.."};
</script>
</article>
      
        <footer><p>CanJS is part of <a href="https://donejs.com" target="_blank">DoneJS</a>. Created and maintained by the core <a href="https://donejs.com/About.html#team" target="_blank">DoneJS team</a> and <a href="https://www.bitovi.com" target="_blank">Bitovi</a>. <strong>Currently 5.18.2.</strong></p>
</footer>
      
    </div>
  </div>
</div>
<survey-ad>
  <button aria-label="Close" class="close" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
  <a href="https://donejs.com/survey.html" target="_blank">
    Help us improve CanJS by taking our community survey
  </a>
</survey-ad>


		
			<script>
				steal = {
				  	instantiated: {
				    	"bundles/bit-docs-site/static.css!$css" : null
				  	}
			  	};
			</script>
			<script type='text/javascript' data-main="bit-docs-site/static" src="../static/steal.production.js"></script>
		
		<script async defer src="https://buttons.github.io/buttons.js"></script>

		<!-- root-level elements with attributes necessary for the app -->
		<div path-prefix=".."></div>

	</body>
</html>
